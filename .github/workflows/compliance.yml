name: Run compliance on insecure branch
# Controls when the workflow will run
on:
  # Triggers the workflow on push or pull request events but only for the insecure branch
  push:
    branches: [ main, insecure ]
  pull_request:
    branches: [ main, insecure ]

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
       # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
      - uses: actions/checkout@v2
          
          
      # Runs a shell script using the runners shell
      - name: Run a shell script
        id: run-shell-script
        run: |
          echo Set execute permission.
          chmod +x "${GITHUB_WORKSPACE}/scripts/artifactory_compliance.sh"
          echo Run script.
          ./scripts/artifactory_compliance.sh >> $complianceStatus
          echo '::set-output name=complianceStatus::$complianceStatus'
          
      - name: Display compliance status
        run:  echo "The compliance status is ${{ steps.checkCompliance.outputs.complianceStatus }}"
        
      - name: Verify compliance status
        if: ${{ steps.checkCompliance.outputs.complianceStatus == 'ABCD' }}
        uses: actions/github-script@v3
        with:
          script: |
            core.setFailed('Failed compliance')
        
